---
import Layout from '../layouts/Layout.astro';
---

<Layout title="Gestione Dati">
	<div class="container">
		<div class="card">
			<div style="padding: 1.5rem 1.5rem 0 1.5rem; margin-bottom: 1.5rem;">
				<h2 style="margin: 0; color: #2c3e50;">ğŸ“Š Gestione Dati</h2>
				<p style="margin: 0.5rem 0 0 0; color: #7f8c8d;">Seleziona un modello per visualizzare e modificare i suoi dati</p>
			</div>
			<div id="models-list" style="padding: 0 1.5rem 1.5rem 1.5rem;">
				<p>ğŸ”„ Caricamento modelli...</p>
			</div>
		</div>
	</div>
	
	<script>
		async function loadModels() {
			try {
				const response = await fetch('http://localhost:8000/api/meta-models/');
				const data = await response.json();
				const models = data.results || data;
				
				const listEl = document.getElementById('models-list');
				if (!listEl) return;
				
				if (models.length === 0) {
					listEl.innerHTML = `
						<div style="text-align: center; padding: 3rem; color: #7f8c8d;">
							<div style="font-size: 3rem; margin-bottom: 1rem;">ğŸ“‹</div>
							<h3 style="margin-bottom: 1rem; color: #2c3e50;">Nessun modello disponibile</h3>
							<p style="margin-bottom: 1.5rem;">Crea prima un modello per gestire i dati</p>
							<a href="/models/new" class="btn btn-primary">â• Crea un modello</a>
						</div>
					`;
					return;
				}
				
				let html = '<div style="display: grid; gap: 1rem;">';
				
				models.forEach((model) => {
					if (model.is_active) {
						html += `
							<div class="card" style="border-left: 4px solid #3498db;">
								<div style="display: flex; justify-content: space-between; align-items: center; padding: 1.5rem;">
									<div style="flex: 1; margin-right: 1rem;">
										<h3 style="margin: 0 0 1rem 0; color: #2c3e50;">${model.name}</h3>
										<p style="margin: 0.25rem 0;"><strong>Descrizione:</strong> ${model.description || 'Nessuna descrizione'}</p>
										<p style="margin: 0.25rem 0;"><strong>Campi:</strong> ${model.meta_fields ? model.meta_fields.length : 0}</p>
									</div>
									<a href="/data/${model.name}" class="btn btn-primary">ğŸ“Š Gestisci Dati</a>
								</div>
							</div>
						`;
					}
				});
				
				html += '</div>';
				listEl.innerHTML = html;
				
			} catch (error) {
				const listEl = document.getElementById('models-list');
				if (listEl) {
					listEl.innerHTML = `
						<div style="text-align: center; padding: 3rem; color: #e74c3c;">
							<div style="font-size: 3rem; margin-bottom: 1rem;">âš ï¸</div>
							<h3 style="margin-bottom: 1rem; color: #c0392b;">Errore di connessione</h3>
							<p style="margin-bottom: 1.5rem;">Impossibile caricare i modelli. Verifica che il server Django sia attivo.</p>
							<button onclick="loadModels()" class="btn btn-primary">ğŸ”„ Riprova</button>
						</div>
					`;
				}
			}
		}
		
		// Carica modelli al load della pagina
		loadModels();
	</script>
</Layout>